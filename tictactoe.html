<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe (Java Port)</title>
    <style>
        /* CSS - The styling (Visuals) */
        body {
            font-family: 'Courier New', Courier, monospace; /* Keeping the console feel */
            background-color: #222;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        h1 { margin-bottom: 10px; }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            background-color: #555;
            border: 5px solid #fff;
        }

        .cell {
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }

        .cell:hover { background-color: #444; }
        .cell.taken { cursor: not-allowed; }
        .cell.x { color: #ff5555; } /* Red for X */
        .cell.o { color: #5555ff; } /* Blue for O */

        #status { font-size: 1.2rem; margin-top: 15px; text-align: center; }
        
        button {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            background-color: #eee;
            border: none;
            font-family: inherit;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>Tic-Tac-Toe</h1>
        
        <div class="board" id="board">
            <div class="cell" onclick="handleMove(0)"></div>
            <div class="cell" onclick="handleMove(1)"></div>
            <div class="cell" onclick="handleMove(2)"></div>
            <div class="cell" onclick="handleMove(3)"></div>
            <div class="cell" onclick="handleMove(4)"></div>
            <div class="cell" onclick="handleMove(5)"></div>
            <div class="cell" onclick="handleMove(6)"></div>
            <div class="cell" onclick="handleMove(7)"></div>
            <div class="cell" onclick="handleMove(8)"></div>
        </div>

        <div id="status">Play as X. Click a box to start.</div>
        <button onclick="resetGame()">Restart Game</button>
    </div>

    <script>
        // JAVASCRIPT - The Logic
        
        let board = ['', '', '', '', '', '', '', '', ''];
        let gameActive = true;
        let humanPlayer = 'X';
        let botPlayer = 'O';
        let turn = humanPlayer; 
        
        // Winning combinations (Rows, Columns, Diagonals)
        const winningComboT = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // Cols
            [0, 4, 8], [2, 4, 6]             // Diagonals
        ];

        const statusDisplay = document.getElementById('status');
        const cells = document.querySelectorAll('.cell');

        // HUMAN MOVE
        function handleMove(index) {
            if (board[index] !== '' || !gameActive || turn !== humanPlayer) {
                return;
            }
            updateBoard(index, humanPlayer);
            checkWinner();

            if (gameActive) {
                turn = botPlayer;
                statusDisplay.innerText = "Bot is thinking...";
                setTimeout(botLogic, 500); 
            }
        }

        // --- UPDATED BOT LOGIC ---
        function botLogic() {
            let moveIndex = -1;

            // PRIORITY 1: ATTACK (Win now)
            // Finds row with: 2 Bot markers + 1 Empty
            moveIndex = findMoveByCount(botPlayer, 2);

            // PRIORITY 2: DEFEND (Block Opponent)
            // Finds row with: 2 Human markers + 1 Empty
            if (moveIndex === -1) {
                moveIndex = findMoveByCount(humanPlayer, 2);
            }

            // PRIORITY 3: CENTER
            if (moveIndex === -1 && board[4] === '') {
                moveIndex = 4;
            }

            // PRIORITY 4: BUILD (The missing step!)
            // Finds row with: 1 Bot marker + 2 Empty spaces (To set up a future win)
            if (moveIndex === -1) {
                moveIndex = findMoveByCount(botPlayer, 1);
            }

            // PRIORITY 5: RANDOM
            if (moveIndex === -1) {
                let availableSpots = [];
                for(let i=0; i<9; i++) {
                    if(board[i] === '') availableSpots.push(i);
                }
                if(availableSpots.length > 0) {
                    let random = Math.floor(Math.random() * availableSpots.length);
                    moveIndex = availableSpots[random];
                }
            }

            // Execute Move
            if (moveIndex !== -1) {
                updateBoard(moveIndex, botPlayer);
                checkWinner();
                if(gameActive) {
                    turn = humanPlayer;
                    statusDisplay.innerText = "Your Turn (X)";
                }
            }
        }

        // Helper function to find moves based on how many markers exist in a row
        // targetCount = 2 means "Find row with 2 of this player and 1 empty" (Win/Block)
        // targetCount = 1 means "Find row with 1 of this player and 2 empty" (Build)
        function findMoveByCount(playerSymbol, targetCount) {
            for (let i = 0; i < winningComboT.length; i++) {
                const [a, b, c] = winningComboT[i];
                let indices = [a, b, c];
                
                // Count how many markers the player has in this row
                let playerCount = 0;
                let emptyCount = 0;
                let emptyIndex = -1;

                indices.forEach(idx => {
                    if (board[idx] === playerSymbol) playerCount++;
                    else if (board[idx] === '') {
                        emptyCount++;
                        emptyIndex = idx;
                    }
                });

                // Logic for Win/Block (2 Player, 1 Empty)
                if (targetCount === 2) {
                    if (playerCount === 2 && emptyCount === 1) return emptyIndex;
                }
                
                // Logic for Build (1 Player, 2 Empty)
                // We verify emptyCount === 2 to ensure the opponent hasn't blocked this row yet
                if (targetCount === 1) {
                    if (playerCount === 1 && emptyCount === 2) return emptyIndex;
                }
            }
            return -1;
        }

        function updateBoard(index, player) {
            board[index] = player;
            cells[index].innerText = player;
            cells[index].classList.add('taken');
            cells[index].classList.add(player.toLowerCase());
        }

        function checkWinner() {
            let roundWon = false;
            let winningSymbol = '';

            for (let i = 0; i < winningComboT.length; i++) {
                const [a, b, c] = winningComboT[i];
                if (board[a] === '' || board[b] === '' || board[c] === '') continue;
                if (board[a] === board[b] && board[b] === board[c]) {
                    roundWon = true;
                    winningSymbol = board[a];
                    break;
                }
            }

            if (roundWon) {
                statusDisplay.innerText = "Congratulations, " + winningSymbol + " won the game!";
                gameActive = false;
                return;
            }

            if (!board.includes('')) {
                statusDisplay.innerText = "It's a draw!";
                gameActive = false;
                return;
            }
        }

        function resetGame() {
            board = ['', '', '', '', '', '', '', '', ''];
            gameActive = true;
            turn = humanPlayer;
            statusDisplay.innerText = "Play as X. Click a box to start.";
            cells.forEach(cell => {
                cell.innerText = '';
                cell.classList.remove('taken', 'x', 'o');
            });
        }
    </script>
</body>
</html>